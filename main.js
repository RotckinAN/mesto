(()=>{"use strict";var e={popup:".popup",popupClose:"popup__close",editButton:".profile__edit-button",popupContentEdit:".popup__content_type_editProfile",popupContentAdd:".popup__content_type_addPicture",itemInputName:".popup__item_input_name",itemInputJob:".popup__item_input_job",profTitle:".profile__title",profSubtitle:".profile__subtitle",profileAvatar:".profile__avatar",openedPopup:"popup_opened",addButton:".profile__add-button",popupEdit:".popup_type_editProfile",popupAdd:".popup_type_addPicture",template:".template",elementsList:".elements__list",elementsItem:".elements__item",itemPictureName:".popup__item_input_pictureName",inputPicture:".popup__item_input_picture",elementPhoto:".element__photo",elementPhotoTitle:".element__title",buttonRemove:".element__trash",buttonLike:".element__like",buttonLikeActive:"element__like_active",photoFullSize:".popup_type_photo-FullSize",photoFullSizeTitle:".popup__title",photoFullSizeElement:".popup__photoElement",form:".popup__content",inputErrorActive:"popup__input-error_active",popupError:"popup__item_type_error",button:".popup__save-button",buttonInvalid:"popup__save-button_invalid",inputError:".popup__input-error",popupItem:".popup__item",likeNumbers:".element__likeNumbers",hiddenButtonRemove:"element__trash_type_hidden",popupDelete:".popup_type_confirmDelete",editAvatarButton:".profile__overlay",avatarEdit:".popup_type_avatarUpdate",popupContentAvatarEdit:".popup__content_type_editAvatar"},t=document.querySelector(e.editButton),n=document.querySelector(e.addButton),r=document.querySelector(e.popupContentEdit),o=r.querySelector(e.itemInputName),i=r.querySelector(e.itemInputJob),u=document.querySelector(e.profTitle),c=document.querySelector(e.profSubtitle),a=document.querySelector(e.profileAvatar),l=document.querySelector(e.popupEdit),s=document.querySelector(e.popupAdd),p=s.querySelector(e.popupContentAdd),f=document.querySelector(e.elementsList),h=document.querySelector(e.photoFullSize),d=h.querySelector(e.photoFullSizeTitle),y=h.querySelector(e.photoFullSizeElement),_=document.querySelector(e.popupDelete),m=document.querySelector(e.editAvatarButton),b=document.querySelector(e.avatarEdit),v=b.querySelector(e.popupContentAvatarEdit);function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(){function t(e,n){var r=e.data,o=e.handleCardClick,i=e.handleLikeClick,u=e.handleDeleteIconClick,c=e.getUserId;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=r.name,this._link=r.link,this._cardUserId=r.owner._id,this._likesNumber=r.likes.length,this._idCard=r._id,this._likesId=r.likes,this._handleCardClick=o,this._handleLikeClick=i,this._templateSelector=n,this._getUserId=c,this._activateDeleteButton=u,this._element=this._getTemplate()}var n,r;return n=t,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(e.elementsItem).cloneNode(!0)}},{key:"_hideDeleteButton",value:function(t){this._getUserId()!==this._cardUserId?t.querySelector(e.buttonRemove).classList.add(e.hiddenButtonRemove):t.querySelector(e.buttonRemove).classList.remove(e.hiddenButtonRemove)}},{key:"_getInintialLikesNumber",value:function(){var t=this;this._element.querySelector(e.likeNumbers).textContent=this._likesNumber,this._likesId.forEach((function(n){n._id===t._getUserId()&&t._element.querySelector(e.buttonLike).classList.add(e.buttonLikeActive)}))}},{key:"getNumbersOfLikes",value:function(t){this._element.querySelector(e.likeNumbers).textContent=t}},{key:"generateCard",value:function(){var t=this;return this._photo=this._element.querySelector(e.elementPhoto),this._photo.src=this._link,this._photo.alt=this._name,this._element.querySelector(e.elementPhotoTitle).textContent=this._name,this._hideDeleteButton(this._element),this._getInintialLikesNumber(),this._element.querySelector(e.buttonRemove).addEventListener("click",(function(e){t._activateDeleteButton(t._idCard,t._element)})),this._element.querySelector(e.buttonLike).addEventListener("click",(function(){t._handleLikeClick(t._element,t._idCard)})),this._photo.addEventListener("click",(function(){t._handleCardClick(t._photo)})),this._element}}])&&k(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}();function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._inputErrorActive=t.inputErrorActive,this._popupError=t.popupError,this._buttonInvalid=t.buttonInvalid,this._inputError=t.inputError,this._popupItem=t.popupItem,this._formType=n,this._submitButton=r,this._inputArray=Array.from(this._formType.querySelectorAll(this._popupItem)),this._formErrorArray=Array.from(this._formType.querySelectorAll(this._inputError))}var t,n;return t=e,(n=[{key:"_handleFormInput",value:function(e){this._showFieldError(e),this.setSubmitButtonState()}},{key:"_showFieldError",value:function(e){var t=e.target,n=t.validity.valid,r=this._formType.querySelector(".".concat(t.id,"-error"));n?(r.classList.remove(this._inputErrorActive),t.classList.remove(this._popupError)):(r.classList.add(this._inputErrorActive),r.textContent=t.validationMessage,t.classList.add(this._popupError))}},{key:"setSubmitButtonState",value:function(){this._formType.checkValidity()?(this._submitButton.removeAttribute("disabled"),this._submitButton.classList.remove(this._buttonInvalid)):(this._submitButton.setAttribute("disabled",!0),this._submitButton.classList.add(this._buttonInvalid))}},{key:"hideErrorMessages",value:function(){var e=this;this._inputArray.forEach((function(t){t.classList.remove(e._popupError)})),this._formErrorArray.forEach((function(t){t.classList.remove(e._inputErrorActive)}))}},{key:"enableValidation",value:function(){var e=this;this._formType.addEventListener("input",(function(t){e._handleFormInput(t)}))}}])&&g(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=function(){function e(t,n){var r=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=r,this._container=n}var t,n;return t=e,(n=[{key:"addItem",value:function(e){this._container.prepend(e)}},{key:"renderItems",value:function(e){this._renderer(e)}}])&&w(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var P=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._popupSelector=e,this._handleEscClose=this._handleEscClose.bind(this)}var n,r;return n=t,(r=[{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"open",value:function(){this._popupSelector.classList.add(e.openedPopup),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popupSelector.classList.remove(e.openedPopup),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var t=this;this._popupSelector.addEventListener("mousedown",(function(n){n.target.classList.contains(e.openedPopup)&&t.close(),n.target.classList.contains(e.popupClose)&&t.close()}))}}])&&L(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}();function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(){return q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=I(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},q.apply(this,arguments)}function I(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},R(e,t)}function A(e,t){if(t&&("object"===C(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(r);if(o){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return A(this,e)});function u(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),i.call(this,e)}return t=u,(n=[{key:"open",value:function(e){y.src=e.src,y.alt=e.alt,d.textContent=e.alt,q(T(u.prototype),"open",this).call(this)}}])&&j(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(P);function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(){return x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=F(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},x.apply(this,arguments)}function F(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=z(e)););return e}function U(e,t){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},U(e,t)}function V(e,t){if(t&&("object"===D(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}var J=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}(c,t);var n,r,o,i,u=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=z(o);if(i){var n=z(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return V(this,e)});function c(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=u.call(this,e))._callbackSubmitForm=t,n._form=n._getForm(),n}return n=c,(r=[{key:"_getForm",value:function(){return this._popupSelector.querySelector(e.form)}},{key:"_getInputValues",value:function(){var t=this;return this._formValues={},this._inputList=Array.from(this._form.querySelectorAll(e.popupItem)),this._inputList.forEach((function(e){t._formValues[e.name]=e.value})),this._formValues}},{key:"setEventListeners",value:function(){var e=this;this._form.addEventListener("submit",(function(t){t.preventDefault(),e._callbackSubmitForm(e._getInputValues()),e.close()})),x(z(c.prototype),"setEventListeners",this).call(this)}},{key:"close",value:function(){this._form.reset(),x(z(c.prototype),"close",this).call(this)}}])&&N(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),c}(P);function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var G=function(){function e(t){var n=t.userNameSelector,r=t.userInfoSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userNameSelector=n,this._userInfoSelector=r}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._userNameSelector.textContent,about:this._userInfoSelector.textContent}}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about;this._userNameSelector.textContent=t,this._userInfoSelector.textContent=n}}])&&M(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var K=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t.url,this._headers=t.headers}var t,n;return t=e,(n=[{key:"_getRequestData",value:function(){return function(e){return e.ok?e.json():Promise.reject("Произошла ошибка, код ошибки: ".concat(e.status))}}},{key:"getUserInfoByRequest",value:function(){return fetch("".concat(this._url,"users/me"),{method:"GET",headers:this._headers}).then(this._getRequestData())}},{key:"getInitialCards",value:function(){return fetch("".concat(this._url,"cards"),{method:"GET",headers:this._headers}).then(this._getRequestData())}},{key:"patchProfileInfo",value:function(e){return fetch("".concat(this._url,"users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._getRequestData())}},{key:"postNewPhoto",value:function(e){return fetch("".concat(this._url,"cards"),{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then(this._getRequestData())}},{key:"deleteCard",value:function(e){return fetch("".concat(this._url,"cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._getRequestData())}},{key:"putLike",value:function(e){return fetch("".concat(this._url,"cards/").concat(e,"/likes"),{method:"PUT",headers:this._headers}).then(this._getRequestData())}},{key:"deleteLike",value:function(e){return fetch("".concat(this._url,"cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers}).then(this._getRequestData())}},{key:"patchProfileAvatar",value:function(e){return fetch("".concat(this._url,"users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._getRequestData())}}])&&H(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function W(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function X(){return X="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Y(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},X.apply(this,arguments)}function Y(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ee(e)););return e}function Z(e,t){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Z(e,t)}function $(e,t){if(t&&("object"===Q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}var te=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z(e,t)}(c,t);var n,r,o,i,u=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ee(o);if(i){var n=ee(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return $(this,e)});function c(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=u.call(this,e))._callbackSubmit=t,n._form=n._getForm(),n}return n=c,(r=[{key:"_getForm",value:function(){return this._popupSelector.querySelector(e.form)}},{key:"setEventListeners",value:function(){var e=this;this._form.addEventListener("submit",(function(t){t.preventDefault(),e._callbackSubmit(t),e.close()})),X(ee(c.prototype),"setEventListeners",this).call(this)}}])&&W(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),c}(P),ne=new K({url:"https://mesto.nomoreparties.co/v1/cohort-50/",headers:{authorization:"d9722592-b388-4281-b273-bb490f84d549","Content-type":"application/json"}}),re="",oe=new G({userNameSelector:u,userInfoSelector:c});ne.getUserInfoByRequest().then((function(e){re=e._id,oe.setUserInfo(e),a.src=e.avatar})).catch((function(e){console.error(e)}));var ie=new J(l,(function(e){ke(!0,l),ne.patchProfileInfo(e).then((function(e){u.textContent=e.name,c.textContent=e.about,oe.setUserInfo(e)})).catch((function(e){console.error(e)})).finally((function(){ke(!1,l)}))}));t.addEventListener("click",(function(){ie.open();var e=oe.getUserInfo(),t=e.name,n=e.about;o.value=t,i.value=n,ye.setSubmitButtonState(),ye.hideErrorMessages()}));var ue=new B(h);ue.setEventListeners();var ce,ae="",le=new te(_,(function(){ne.deleteCard(ae).then((function(){ce.remove(),ce=""})).catch((function(e){console.error(e)}))}));le.setEventListeners();var se=function(t){var n=new S({data:t,handleCardClick:function(e){ue.open(e)},handleLikeClick:function(t,r){t.querySelector(e.buttonLike).classList.contains(e.buttonLikeActive)?(t.querySelector(e.buttonLike).classList.toggle(e.buttonLikeActive),ne.deleteLike(r).then((function(e){n.getNumbersOfLikes(e.likes.length)})).catch((function(e){console.error(e)}))):(t.querySelector(e.buttonLike).classList.toggle(e.buttonLikeActive),ne.putLike(r).then((function(e){n.getNumbersOfLikes(e.likes.length)})).catch((function(e){console.error(e)})))},handleDeleteIconClick:function(e,t){ae=e,ce=t,le.open()},getUserId:function(){return re}},e.template);return n.generateCard()},pe=new O({renderer:function(e){pe.addItem(se(e))}},f);ne.getInitialCards().then((function(e){e.reverse(),e.map((function(e){pe.renderItems(e)}))})).catch((function(e){console.error(e)}));var fe=new J(s,(function(e){Se(!0,s),ne.postNewPhoto(e).then((function(e){var t=se(e);pe.addItem(t)})).catch((function(e){console.error(e)})).finally((function(){Se(!1,s)}))}));n.addEventListener("click",(function(){fe.open(),me.setSubmitButtonState(),me.hideErrorMessages()}));var he=new J(b,(function(e){ke(!0,b),ne.patchProfileAvatar(e).then((function(e){a.src=e.avatar})).catch((function(e){console.error(e)})).finally((function(){ke(!1,b)}))}));m.addEventListener("click",(function(){he.open(),ve.setSubmitButtonState(),ve.hideErrorMessages()})),ie.setEventListeners(),fe.setEventListeners(),he.setEventListeners();var de=r.querySelector(e.button),ye=new E(e,r,de);ye.enableValidation();var _e=p.querySelector(e.button),me=new E(e,p,_e);me.enableValidation();var be=v.querySelector(e.button),ve=new E(e,v,be);ve.enableValidation();var ke=function(t,n){n.querySelector(e.button).textContent=t?"Сохранение...":"Сохранить"},Se=function(t,n){n.querySelector(e.button).textContent=t?"Создание...":"Создать"}})();